(function(h,g){"function"===typeof define&&define.amd?define(g):h.simpleStorage=g()})(this,function(){function h(){window.localStorage.setItem("__simpleStorageInitTest","tmpval");window.localStorage.removeItem("__simpleStorageInitTest");r();k();"addEventListener"in window?window.addEventListener("storage",g,!1):document.attachEvent("onstorage",g);"addEventListener"in window&&window.addEventListener("pageshow",function(a){a.persisted&&g()},!1);n=!0}function g(){try{r()}catch(a){n=!1;return}k()}function r(){var b=
localStorage.simpleStorage;try{a=JSON.parse(b)}catch(c){a={}}p=localStorage.simpleStorage?String(localStorage.simpleStorage).length:0}function l(){try{localStorage.simpleStorage=JSON.stringify(a),p=localStorage.simpleStorage?String(localStorage.simpleStorage).length:0}catch(b){return b}return!0}function k(){var b,c,f,d,e,g=Infinity,h=0;clearTimeout(m);if(a&&a.__simpleStorage_meta&&a.__simpleStorage_meta.TTL){b=+new Date;e=a.__simpleStorage_meta.TTL.keys||[];d=a.__simpleStorage_meta.TTL.expire||{};
c=0;for(f=e.length;c<f;c++)if(d[e[c]]<=b)h++,delete a[e[c]],delete d[e[c]];else{d[e[c]]<g&&(g=d[e[c]]);break}Infinity!=g&&(m=setTimeout(k,Math.min(g-b,2147483647)));h&&(e.splice(0,h),s(),l())}}function q(b,c){var f=+new Date,d,e;c=Number(c)||0;if(0!==c)if(a.hasOwnProperty(b)){a.__simpleStorage_meta||(a.__simpleStorage_meta={});a.__simpleStorage_meta.TTL||(a.__simpleStorage_meta.TTL={expire:{},keys:[]});a.__simpleStorage_meta.TTL.expire[b]=f+c;if(a.__simpleStorage_meta.TTL.expire.hasOwnProperty(b))for(d=
0,e=a.__simpleStorage_meta.TTL.keys.length;d<e;d++)a.__simpleStorage_meta.TTL.keys[d]==b&&a.__simpleStorage_meta.TTL.keys.splice(d);d=0;for(e=a.__simpleStorage_meta.TTL.keys.length;d<e;d++)a.__simpleStorage_meta.TTL.expire[a.__simpleStorage_meta.TTL.keys[d]]>f+c&&a.__simpleStorage_meta.TTL.keys.splice(d,0,b);a.__simpleStorage_meta.TTL.keys.push(b)}else return!1;else if(a&&a.__simpleStorage_meta&&a.__simpleStorage_meta.TTL){if(a.__simpleStorage_meta.TTL.expire.hasOwnProperty(b))for(delete a.__simpleStorage_meta.TTL.expire[b],
d=0,e=a.__simpleStorage_meta.TTL.keys.length;d<e;d++)if(a.__simpleStorage_meta.TTL.keys[d]==b){a.__simpleStorage_meta.TTL.keys.splice(d,1);break}s()}clearTimeout(m);a&&a.__simpleStorage_meta&&a.__simpleStorage_meta.TTL&&a.__simpleStorage_meta.TTL.keys.length&&(m=setTimeout(k,Math.min(Math.max(a.__simpleStorage_meta.TTL.expire[a.__simpleStorage_meta.TTL.keys[0]]-f,0),2147483647)));return!0}function s(){var b=!1,c=!1,f;if(!a||!a.__simpleStorage_meta)return b;a.__simpleStorage_meta.TTL&&!a.__simpleStorage_meta.TTL.keys.length&&
(delete a.__simpleStorage_meta.TTL,b=!0);for(f in a.__simpleStorage_meta)if(a.__simpleStorage_meta.hasOwnProperty(f)){c=!0;break}c||(delete a.__simpleStorage_meta,b=!0);return b}var a=!1,p=0,n=!1,m=null;try{h()}catch(t){}return{version:"0.1.2",canUse:function(){return!!n},set:function(b,c,f){if("__simpleStorage_meta"==b||!a)return!1;if("undefined"==typeof c)return this.deleteKey(b);f=f||{};try{c=JSON.parse(JSON.stringify(c))}catch(d){return d}a[b]=c;q(b,f.TTL||0);return l()},get:function(b){if(!a)return!1;
if(a.hasOwnProperty(b)&&"__simpleStorage_meta"!=b&&this.getTTL(b))return a[b]},deleteKey:function(b){return a?b in a?(delete a[b],q(b,0),l()):!1:!1},setTTL:function(b,c){if(!a)return!1;q(b,c);return l()},getTTL:function(b){return a?a.hasOwnProperty(b)?a.__simpleStorage_meta&&a.__simpleStorage_meta.TTL&&a.__simpleStorage_meta.TTL.expire&&a.__simpleStorage_meta.TTL.expire.hasOwnProperty(b)?(b=Math.max(a.__simpleStorage_meta.TTL.expire[b]-+new Date||0,0))||!1:Infinity:!1:!1},flush:function(){if(!a)return!1;
a={};try{return localStorage.removeItem("simpleStorage"),!0}catch(b){return b}},index:function(){if(!a)return!1;var b=[],c;for(c in a)a.hasOwnProperty(c)&&"__simpleStorage_meta"!=c&&b.push(c);return b},storageSize:function(){return p}}});